{% extends "base.html" %}

{% block body %}
    <div class="maincontent">
        <div class="row">
            <div class="col"></div>
            <div class="col-9">
                <div class="row">
                    <div class="col">
                        <img src="{{ url_for('static', filename='images/yumgum.png') }}" alt="{{ product.name }}" id="prodimg">
                    </div>
                    <div class="col-4">
                        <h1 id="prodtitle">{{ product.name }}</h1>
                        <h2 class="prodinfo">{{ product.vitamin }}</h2>
                        <h3 class="prodinfo">{{ product.flavour }}</h3>
                        <div id="proddesc">
                            <h4 class="prodmininfo">Product Description</h4>
                            <h5>{{ product.description }}</h5>
                        </div>
                        <div id="prodhealth">
                            <h4 class="prodmininfo">Health Benefits</h4>
                            <p>{{ product.health_benefits or "No health benefits listed." }}</p>
                        </div>
                        <h1 class="prodinfo">Â£{{ "%.2f"|format(product.price) }}</h1>
                        <h2 class="prodmininfo">Quantity</h2>
                        <div id="quantbutt">
                            <div id="prodquant">
                                <a href="#" id="quantminus"><h1 class="quantxt">_</h1></a>
                                <span id="quantity">1</span>
                                <a href="#" id="quantplus"><h1 class="quantxt">+</h1></a>
                            </div>
                        </div>
                        <div id="prodbotbut">
                            <a href="#" id="prodbasket" data-product-id="{{ product.id }}">
                                <h1>Add to Basket</h1>
                                <img src="{{ url_for('static', filename='images/basketcheck.svg') }}" height="45">
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg" id="prodwishadd">
                                <img src="{{ url_for('static', filename='images/heart.svg') }}">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col"></div>
        </div>
    </div>

    <script>
        // Update the quantity based on the + and - buttons
        document.addEventListener("DOMContentLoaded", function () {
            const minusBtn = document.getElementById("quantminus");
            const plusBtn = document.getElementById("quantplus");
            const quantitySpan = document.getElementById("quantity");
    
            let quantity = 1;
    
            minusBtn.addEventListener("click", function (event) {
                event.preventDefault();
                if (quantity > 1) {
                    quantity--;
                    quantitySpan.textContent = quantity;
                }
            });
    
            plusBtn.addEventListener("click", function (event) {
                event.preventDefault();
                quantity++;
                quantitySpan.textContent = quantity;
            });
        });

        // When clicking "Add to Basket", send an AJAX request
        document.getElementById("prodbasket").addEventListener("click", function (event) {
    event.preventDefault();

    const productId = this.getAttribute("data-product-id");
    const quantity = document.getElementById("quantity").textContent;

    // Send AJAX request
    fetch(`/addToCart/${productId}`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",  // Ensure this is set
        },
        body: JSON.stringify({ quantity: quantity })  // Send the quantity as JSON
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            // Create and show a custom success message (or display notification)
            showSuccessMessage(data.message);
        }
    })
    .catch(error => console.error("Error:", error));
});

// Function to show success message on the page
function showSuccessMessage(message) {
    // Create a div for the success message
    const alertDiv = document.createElement('div');
    alertDiv.classList.add('alert', 'alert-success', 'alert-dismissible', 'fade', 'show');
    alertDiv.setAttribute('role', 'alert');
    alertDiv.innerHTML = `${message} <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;

    // Append the alert message to the body (or any container you'd like)
    document.body.insertBefore(alertDiv, document.body.firstChild);

    window.scrollTo({
        top: 0, // Scroll to the top of the page
        behavior: 'smooth' // Smooth scrolling animation
    });
    
    // Optionally, remove the message after a few seconds (for auto-dismiss)
    setTimeout(() => {
        alertDiv.classList.remove('show');
        alertDiv.classList.add('fade');
    }, 5000);  // Hide after 5 seconds
}
    </script>

{% endblock %}
